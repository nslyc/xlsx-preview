!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("exceljs"),require("buffer"),require("readable-stream")):"function"==typeof define&&define.amd?define(["exceljs","buffer","readable-stream"],e):"object"==typeof exports?exports.xlsxPreview=e(require("exceljs"),require("buffer"),require("readable-stream")):t.xlsxPreview=e(t.exceljs,t.buffer,t["readable-stream"])}(self,((t,e,n)=>(()=>{"use strict";var o={408:t=>{t.exports=e},674:e=>{e.exports=t},216:t=>{t.exports=n}},r={};function l(t){var e=r[t];if(void 0!==e)return e.exports;var n=r[t]={exports:{}};return o[t](n,n.exports,l),n.exports}l.d=(t,e)=>{for(var n in e)l.o(e,n)&&!l.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{l.r(s),l.d(s,{default:()=>T,xlsx2Html:()=>j});var t=l(674),e=l(408),n=l(216);function o(t){let e="";for(const n of t){let t=n.toString(16);for(;t.length<2;)t="0"+t;e+=t}return e}const r=function(){const t=crypto.getRandomValues(new Uint8Array(8)),e=t.slice(0,4),n=t.slice(4);return`${o(e)}-${o(n)}`}(),i=`excel-sheets-${r}`,a=`table-${r}`,c=`tbody-${r}`,f=`sheet-${r}`,d=`sheet-toggle-bar-${r}`,u=`locate-btns-x-${r}`,$=`l-btn-${r}`,p=`toggle-btns-x-${r}`,h=`t-btn-${r}`;let b=20,x=16;const g=`\nfunction toggleBtnEventBind() {\n  document.querySelector('.${p}').addEventListener('click',e => {\n    const target = e.target;\n    if(target.classList.contains('${h}')) {\n      const index = target.dataset.index;\n      setActiveByIndex(index);\n    }\n  })\n}\n`,m=`\nconst sheetBtnOffsetMap = (function calcSheetToggleBtnOffset() {\n  const result = [];\n  const btns = document.querySelectorAll(".${h}");\n  btns.forEach((ele, idx) => {\n    result[idx] = ele.offsetLeft;\n  });\n  return result;\n})();\n`,v=`\nfunction setActiveByIndex(index) {\n  document.querySelector('.${h}.active').classList.remove('active');\n  document.querySelector('.${f}.active').classList.remove('active');\n  document.querySelector('.${h}[data-index="' + index + '"]').classList.add("active");\n  document.querySelector('.${f}[data-index="' + index + '"]').classList.add("active");\n}\n`,y=`\nlet offsetIndex = 0;\nfunction locateBtnEventBind() {\n  document.querySelector('.${u}').addEventListener('click', e => {\n    const target = e.target;\n    if (target.classList.contains('${$}')) {\n      const toggleBtnX = document.querySelector('.${p}');\n      switch (target.id) {\n        case 'first-${r}':\n          toggleBtnX.scrollTo({ left: 0 });\n          offsetIndex = 0;\n          break;\n        case 'last-${r}':\n          toggleBtnX.scrollTo({ left: sheetBtnOffsetMap[sheetBtnOffsetMap.length - 1] })\n          offsetIndex = sheetBtnOffsetMap.length - 1;\n          break;\n        case 'prev-${r}':\n          toPrevOffsetIndex(toggleBtnX);\n          break;\n        case 'next-${r}':\n          if (offsetIndex === sheetBtnOffsetMap.length - 1) return;\n          toggleBtnX.scrollTo({ left: sheetBtnOffsetMap[++offsetIndex] });\n          break;\n        default:\n          break;\n      }\n    }\n  })\n}\n`,w={};function B(t,e){if(w[t])return`<tr>${e}${w[t]}</tr>`;let n="";for(let e=1;e<=t;e++)n+="<td></td>";return w[t]=n,`<tr>${e}${n}</tr>`}function O(t,e){const{rows:n,cols:o}=e,{tl:r,br:l}=t,s=(r.col-r.nativeCol)*o[Math.ceil(r.col)],i=(r.row-r.nativeRow)*n[Math.ceil(r.row)];let a=0;for(let t=r.nativeCol;t>=0;t--)a+=o[t];let c=0;for(let t=r.nativeRow;t>=0;t--)c+=n[t];const f=a+s,d=c+i,u=(l.col-l.nativeCol)*o[Math.ceil(l.col)],$=(l.col-l.nativeCol)*n[Math.ceil(l.row)];let p=0;for(let t=l.nativeCol;t>=0;t--)p+=o[t];let h=0;for(let t=l.nativeRow;t>=0;t--)h+=n[t];return{left:f,top:d,width:p+u-f,height:h+$-d}}function k(t,e,n){if(t.width)return t;const{cols:o}=n,{tl:r,br:l}=e,s=(l.nativeColOff-r.nativeColOff)/1e4,i=r.nativeColOff/1e4;let a=0;for(let t=r.nativeCol;t>=0;t--)a+=o[t];const c=a+i;return Object.assign(Object.assign({},t),{left:c,width:s})}function S(t){let e="";const{bold:n,italic:o,family:r,name:l,size:s,underline:i,color:a}=t;return n&&(e+="font-weight: bold;"),o&&(e+="font-style: italic;"),r&&(e+=`font-family: ${l};`),s&&(e+=`font-size: ${s}px;`),i&&(e+="text-decoration: underline;"),a&&a.argb&&(e+=`color: ${C(a.argb)};`),e}function C(t){const{a:e,r:n,g:o,b:r}=function(t){if(8!==t.length)throw"This is not a standard argb string.";const e=[];for(let n=0;n<4;n++)e.push(t.substr(2*n,2));const[n,o,r,l]=e.map((t=>parseInt(t,16)));return{a:n,r:o,g:r,b:l}}(t);return`rgba(${n},${o},${r},${e/255})`}function M(e){let n=null;if(e.isMerged){if(e.master!==e)return"";n=function(t){if(!t.isMerged||t.master!==t)return null;const{row:e,col:n}=t.fullAddress;let o,r=e+1;do{o=t.worksheet.findCell(r++,n)}while(o&&o.master===t);let l=n+1;o=void 0;do{o=t.worksheet.findCell(e,l++)}while(o&&o.master===t);const s={};return r-e>1&&(s.row=r-e-1),l-n>1&&(s.col=l-n-1),s}(e)}let o=function(e){const{type:n,value:o}=e;switch(n){case t.ValueType.Null:return"";case t.ValueType.Hyperlink:return function(t){return`<a href="${t.hyperlink}" target="_blank">${t.text}</a>`}(o);case t.ValueType.RichText:return function(t){const e=t.richText;let n="";for(const t of e){let e="";t.font&&(e=S(t.font)),n+=e?`<span style="${e}">${t.text}</span>`:`<span>${t.text}</span>`}return n}(o);case t.ValueType.Formula:return function(t){return"0.00%"===t.numFmt?(100*t.result).toFixed(2)+"%":t.result||""}(e);case t.ValueType.Date:return function(t){return t.toString()}(o);default:return o||""}}(e),r="";n&&(n.col&&(r+=` colspan="${n.col}"`),n.row&&(r+=` rowspan="${n.row}"`));let l="";return e.font&&(l+=S(e.font)),e.alignment&&(l+=function(t){let e="";const{horizontal:n,vertical:o,indent:r,readingOrder:l}=t;return n&&(e+=`text-align: ${n};`),o&&(e+=`vertical-align: ${o};`),r&&(e+=`text-indent: ${r};`),l&&(e+=`direction: ${l};`),e}(e.alignment)),e.fill&&(l+=function(t){const{type:e}=t;if("pattern"===e){const{fgColor:e,bgColor:n}=t;if(e&&e.argb)return`background-color: ${C(e.argb)};`;if(n&&n.argb)return`background-color: ${C(n.argb)};`}return""}(e.fill)),l&&(r+=` style="${l}"`),`<td${r}>${o}</td>`}function R(t){return e=this,n=void 0,l=function*(){const e={rows:[],cols:[]},n={};t.eachRow(((t,e)=>{n[e]=t}));const o=t.lastRow&&t.lastRow.number||0,l=Math.max(o,b),s=t.lastColumn&&t.lastColumn.number||0,i=Math.max(s,x),{resultRows:f,rowsSpan:d}=function(t,e,n,o){let r="";const l=[];for(let s=1;s<=e;s++){let e="";const i=`<td class="order order-row">${s}</td>`;let a;if(t[s]){const{height:r}=t[s];let l="";for(let t=1;t<=n;t++){const e=o.findCell(s,t);l+=e?M(e):"<td></td>"}let c="";r?(c+=` style="height:${r}px;"`,a=r):a=24,e+=`<tr${c}>${i}${l}</tr>`}else a=24,e+=B(n,i);r+=e,l[s]=a}return{resultRows:r,rowsSpan:l}}(n,l,i,t);e.rows=[24,...d];const{sheetWidth:u,orderCol:$,colStyles:p,colsSpan:h}=function(t,e){const n=e.properties.defaultColWidth||9;let o=0,r='<td class="order order-row"></td>',l="";const s=[];for(let i=1;i<=t;i++){const t=e.getColumn(i);if(r+=`<td class="order order-col index-${i}">${t.letter}</td>`,t.width){const e=72*t.width/n;s[i]=e,o+=e,l+=`.${c} td.index-${i} { width: ${e}px; }`}else o+=72,s[i]=72}return{sheetWidth:o,orderCol:r,colStyles:l,colsSpan:s}}(i,t);e.cols=[32,...h];const g=t.views.some((t=>!t.showGridLines))?`.${c}.${c} td:not(.order) { border: none; }`:"";let m=`<body class="embed-body-${r}">\n        <table class="${a}">\n            <tbody class="${c}">${$+f}</tbody>\n        </table>\n    </body>`;const v=`.${a} { width: ${u}px; } ${g}`,y=yield function(t,e){return n=this,o=void 0,l=function*(){const n=t.getImages();let o="";for(const r of n){let n=O(r.range,e);const{left:l,top:s,width:i,height:a}=k(n,r.range,e),c=`position: absolute; left: ${l}px; top: ${s}px; width: ${i}px; height: ${a}px;`,f=t.workbook.getImage(r.imageId),d=`image/${f.extension}`;f.base64?o+=`<img src="${f.base64}" style="${c}" />`:f.buffer&&(o+=`<object type="${d}" data="${URL.createObjectURL(new Blob([f.buffer],{type:d}))}" style="${c}"></object>`)}return o},new((r=void 0)||(r=Promise))((function(t,e){function s(t){try{a(l.next(t))}catch(t){e(t)}}function i(t){try{a(l.throw(t))}catch(t){e(t)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(s,i)}a((l=l.apply(n,o||[])).next())}));var n,o,r,l}(t,e);return m+=y,m+=`<style>${v}${p}</style>`,m+=`\n    <style>\n      .embed-body-${r} { margin: 0; padding: 0; }\n      .${a} { border-collapse: collapse; table-layout: fixed; }\n      .${c} { border-right: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }\n      .${c} td { border-left: 1px solid #f0f0f0; border-top: 1px solid #f0f0f0; width: 72px; height: 24px; text-overflow: ellipsis; overflow: hidden; }\n      .${c} td.order { color: #333; text-align: center; background: #b6d9fb; }\n      .${c} td.order-row { width: 32px; }\n    </style>`,m},new((o=void 0)||(o=Promise))((function(t,r){function s(t){try{a(l.next(t))}catch(t){r(t)}}function i(t){try{a(l.throw(t))}catch(t){r(t)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(s,i)}a((l=l.apply(e,n||[])).next())}));var e,n,o,l}function j(o,l){return s=this,a=void 0,w=function*(){var s;let a;if((null==l?void 0:l.minimumRows)&&((s=l.minimumRows)<20&&console.warn("setMinimumNumberRows: count less then DEFAULT_NUMBER_ROWS."),b=s),(null==l?void 0:l.minimumCols)&&function(t){t<16&&console.warn("setMinimumNumberCols: count less then DEFAULT_NUMBER_COLS."),x=t}(l.minimumCols),o instanceof Blob)a=yield o.arrayBuffer();else{if(!(o instanceof ArrayBuffer))throw"xlsx2Html(data, options): The parameter data can only be passed ArrayBuffer, Blob or File type";a=o}const c=new t.Workbook;if("csv"==(null==l?void 0:l.format)){let t=new n.Readable;t.push(e.Buffer.from(a)),t.push(null),yield c.csv.read(t)}else yield c.xlsx.load(a);const w=c.worksheets.length,B=[];for(let t=0;t<w;t++){const e=yield R(c.worksheets[t]);B.push(e)}if(!0===(null==l?void 0:l.separateSheets))return"arrayBuffer"===l.output?B.map((t=>L(t))):B;const O=function(t,e){let n="",o="";for(let r=0;r<t.length;r++){const l="text/html",s=URL.createObjectURL(new Blob([t[r]],{type:l})),i=0===r?" active":"";n+=`<object class="${f}${i}" data-index="${r}" type="${l}" data="${s}"></object>`,o+=`<button class="${h}${i}" data-index="${r}">${e[r].name}</button>`}return n+=`<div class="${d}"><div class="${u}">\n    <button class="${$}" id="first-${r}">⇤</button>\n    <button class="${$}" id="prev-${r}">←</button>\n    <button class="${$}" id="next-${r}">→</button>\n    <button class="${$}" id="last-${r}">⇥</button>\n  </div><div class="${p}">${o}</div></div>`,n+=`\n    <style>\n      body { margin-bottom: 0; }\n      .${i} { position: relative; height: 100%; }\n      .${f} { display: none; width: 100%; height: calc(100% - 30px); }\n      .${f}.active { display: block; }\n      .${d} { position: fixed; left: 0px; bottom: 0px; width: 100%; display: flex; }\n      .${u} { display: flex; algin-items: center; margin-right: 1px; }\n      .${$} { height: 30px; border: none; }\n      .${$}:active { background: #fff; }\n      .${p} { position: relative; flex: 1; overflow: hidden; white-space: nowrap; }\n      .${h} { height: 30px; padding: 0 15px; border: none; box-shadow: 1px 0 2px #ccc; }\n      .${h}.active { border-bottom: 2px solid; background: #fff; }\n    </style>\n  <script>\n    ${g}\n    ${m}\n    ${v}\n    \nfunction toPrevOffsetIndex(toggleBtnX) {\n  if (offsetIndex === 0) return;\n  const scrollLeft = toggleBtnX.scrollLeft;\n  const scrollWidth = toggleBtnX.scrollWidth;\n  const offsetWidth = toggleBtnX.offsetWidth;\n  const maxOffset = scrollWidth - offsetWidth;\n  let idx = offsetIndex - 1;\n  while (idx >= 0) {\n    let cur = sheetBtnOffsetMap[idx];\n    if (cur < maxOffset) {\n      toggleBtnX.scrollTo({ left: cur });\n      offsetIndex = idx;\n      break;\n    }\n    idx--;\n  }\n}\n\n    ${y}\n    window.onload = function() {\n      toggleBtnEventBind();\n      locateBtnEventBind();\n    }\n  <\/script>`,`<div class="${i}">${n}</div>`}(B,c.worksheets);return"arrayBuffer"===(null==l?void 0:l.output)?L(O):O},new((c=void 0)||(c=Promise))((function(t,e){function n(t){try{r(w.next(t))}catch(t){e(t)}}function o(t){try{r(w.throw(t))}catch(t){e(t)}}function r(e){var r;e.done?t(e.value):(r=e.value,r instanceof c?r:new c((function(t){t(r)}))).then(n,o)}r((w=w.apply(s,a||[])).next())}));var s,a,c,w}function L(t){return new Blob([t],{type:"text/html"}).arrayBuffer()}const T={xlsx2Html:j}})(),s})()));
//# sourceMappingURL=xlsxPreview.umd.js.map